{% extends 'index.html' %}
{% block content %}

{% for account in response %}
{% if account.account_devices %}
<form name="form" enctype="application/x-www-form-urlencoded" action="{% url 'dashboard:download' %}"
      method="POST">

    {% csrf_token %}
    <div class="row justify-content-center">
        <div class="col-lg-6">
            <div class="form-group row">
                <input type="hidden" class="form-control" id="downloadAsCsv" name="downloadAsCsv"
                       value="{{ response }}">
            </div>
            <div class="form-group row justify-content-center">
                <button type="submit" class="btn btn-success">Download as Excel</button>
            </div>
        </div>
    </div>
</form>
{% endif%}
{% endfor %}

<div class="col-lg-12">

    <table class="table">

        {% if response %}

        {% for account in response %}

        <tbody>

        {% if account.account_devices %}


        <thead>
        <tr>
            <th scope="col">Account</th>
            <th scope="col">Device</th>
            <th scope="col">IMEI</th>
            <th scope="col">SIM_Number</th>
            <th scope="col">Added_On</th>
            <th scope="col">Last_Reported_Date</th>
            <th scope="col">Last_Reported_Time</th>
            <th scope="col">OTA Commands</th>
        </tr>
        </thead>
        {% for device in account.account_devices %}

        <tr>
            <th scope="row">{{ account.account_name }}</th>
            <td>{{ device.device_name }}</td>
            <td>{{ device.imei }}</td>
            <td>{{ device.sim_number }}</td>
            <td>{{ device.added_on }}</td>
            <td>{{ device.last_reported_date }}</td>
            <td>{{ device.last_reported_time }}</td>
            <td>
                <div class="btn-group">
                    <a href="{% url 'ota:reset' %}?imei_number={{device.imei}}&device_name={{device.device_name}}"
                       class="btn btn-sm btn-outline-secondary"
                       role="button">
                        <i class="fa fa-sync-alt"></i> Reset
                    </a>

                    <a href="{% url 'ota:ping' %}?imei_number={{device.imei}}&device_name={{device.device_name}}"
                       class="btn btn-sm btn-outline-secondary" role="button">
                        <i class="fas fa-map-marker-alt"></i> Ping Device
                    </a>

                    <a href="{% url 'ota:apn' %}?imei_number={{device.imei}}&device_name={{device.device_name}}"
                       class="btn btn-sm btn-outline-secondary" role="button">
                        <i class="fas fa-wrench"></i> Set APN
                    </a>

                </div>
            </td>
        </tr>
        {% endfor %}
        {% else %}
        <center>
            <br/>
            <h1> Congratulation!! All your devices are reporting </h1>
        </center>
        {% endif %}


        </tbody>
        {% endfor %}
        {% endif %}
    </table>


</div>
{% endblock %}

